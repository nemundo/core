<?phpnamespace Nemundo\Core\Json\Reader;use Nemundo\Core\Base\DataSource\AbstractDataSource;use Nemundo\Core\Log\LogMessage;use Nemundo\Core\Text\ByteOrderMarkText;use Nemundo\Core\TextFile\Reader\TextFileReader;use Nemundo\Core\WebRequest\Curl\JsonCurlWebRequest;class JsonReader extends AbstractDataSource{    /**     * @var string     */    public $filter;    /**     * @var string     */    private $text;    public function fromFilename($filename)    {        $file = new TextFileReader($filename);        $this->text = $file->getText();        return $this;    }    public function fromUrl($url)    {        $webRequest = new JsonCurlWebRequest();        $this->fromText($webRequest->getUrl($url)->html);        return $this;    }    public function fromText($text)    {        $this->text = $text;        return $this;    }    public function getList()    {        $text = (new ByteOrderMarkText())->removeByteOrderMark($this->text);        $list = json_decode($text, true);        $this->checkError();        return $list;    }    protected function loadData()    {        $text = trim((new ByteOrderMarkText())->removeByteOrderMark($this->text));        if ($text !== '') {            $this->list = json_decode($text, true);            $this->checkError();            if ($this->filter !== null) {                if (isset($this->list[$this->filter])) {                    $this->list = $this->list[$this->filter];                } else {                    (new LogMessage())->writeError('Filter "' . $this->filter . '"" not found');                    $this->list = [];                }            }        }    }    private function checkError()    {        switch (json_last_error()) {            case JSON_ERROR_NONE:                break;            case JSON_ERROR_DEPTH:                echo ' - Maximale Stacktiefe überschritten';                break;            case JSON_ERROR_STATE_MISMATCH:                echo ' - Unterlauf oder Nichtübereinstimmung der Modi';                break;            case JSON_ERROR_CTRL_CHAR:                echo ' - Unerwartetes Steuerzeichen gefunden';                break;            case JSON_ERROR_SYNTAX:                echo ' - Syntaxfehler, ungültiges JSON';                //(new Debug())->write($text);                break;            case JSON_ERROR_UTF8:                echo ' - Missgestaltete UTF-8 Zeichen, möglicherweise fehlerhaft kodiert';                break;            default:                echo ' - Unbekannter Fehler';                break;        }    }}